<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <div id="map"></div>
    <div id="panel"></div>
    <script>
      let geocoder;
      const API_KEY = 'AIzaSyApioxBwiuVklPoi8EP1RWyvVmsGQIo4bk';

      function initMap() {
        const map = new google.maps.Map(document.getElementById('map'), {
          zoom: 5,
          center: {lat: 32.109333, lng: 34.855499}
        });

        const directionsService = new google.maps.DirectionsService;
        const directionsRenderer = new google.maps.DirectionsRenderer({
          draggable: true,
          map: map,
          panel: document.getElementById('panel')
        });

        const directionsRenderer2 = new google.maps.DirectionsRenderer({
          draggable: true,
          map: map,
          panel: document.getElementById('panel')
        });

        geocoder = new google.maps.Geocoder();

        displayRoute('Sderot Nordau 9, Tel Aviv-Yafo, Israel', 'Ramat Gan, Israel', directionsService,
          directionsRenderer, [{
            location: 'Tel Aviv-Yafo, Israel'
          }, {
            location: 'Sderot Yerushalayim 101, Ramat Gan, Israel'
          }, {
            location: "Degel Re'uven, Petah Tikva, Israel"
          }], 'DRIVING');

        displayRoute('HaYarkon 307-305, Tel Aviv-Yafo, Israel', 'HaHalacha Bridge, Tel Aviv-Yafo, Israel', directionsService,
          directionsRenderer2, null, 'TRANSIT');

      };

      const displayRoute = (origin, destination, service, display, waypoints, mode) => {
        service.route({
          origin: origin,
          destination: destination,
          waypoints,
          travelMode: mode,
        }, function(response, status) {
          if (status === 'OK') {
            display.setDirections(response);
            response.routes.forEach(route => {
              route.legs.forEach(leg => {
                leg.steps.forEach(step => {
                  const startLat = step.start_point.lat();
                  const startLon = step.start_point.lng();

                  const endLat = step.end_point.lat();
                  const endLon = step.end_point.lng();

                  fetch(`https://www.overpass-api.de/api/interpreter?data=[out:json];way(${startLon},${startLat},${endLon}, ${endLat});out%20meta;`)
                    .then(res => res.json())
                    .then(console.log.bind(console))
                    .catch(console.error.bind(console));

                  fetch(`https://www.overpass-api.de/api/interpreter?data=[out:json];way(${startLon},${startLat},${endLon}, ${endLat});out%20meta;`)
                    .then(res => res.json())
                    .then(console.log.bind(console))
                    .catch(console.error.bind(console));
                });
              });
            })
          } else {
            alert('Could not display directions due to: ' + status);
          }
        });
      }

    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyApioxBwiuVklPoi8EP1RWyvVmsGQIo4bk&callback=initMap"
            type="text/javascript"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #map {
            height: 100%;
            width: 49%;
            float: left;
        }
        #panel {
            height: 100%;
            width: 49%;
            float: right;
            overflow-y: auto;
        }
    </style>
</body>
</html>
